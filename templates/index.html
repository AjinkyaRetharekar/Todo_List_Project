{% extends 'base.html' %}
{% block body %}
<div class="content-wrapper">
    {% if filter == 'home' %}
    <h2>Add a New To-Do</h2>
    <form method="POST">
        <div class="form-group">
            <label for="title">To Do Title</label>
            <input type="text" name="title" id="title" required>
        </div>
        <div class="form-group">
            <label for="desc">To Do Description</label>
            <input type="text" name="desc" id="desc" required>
        </div>
        <button type="submit">Add To-Do</button>
    </form>
    {% endif %}

    <h2>Your To-Dos</h2>

    {% if todos|length == 0 %}
        <div class="no-records">No records yet.</div>
    {% else %}
        <table class="table">
            <thead>
                <tr>
                    <th>Sr.No</th>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Time</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for todo in todos %}
                    <tr class="{% if todo.is_complete %}completed{% endif %}">
                        <th>{{ loop.index }}</th>
                        <td>{{ todo.title }}</td>
                        <td>{{ todo.desc }}</td>
                        <td>{{ todo.date_created }}</td>
                        <td>
                            <div>
                                <button onclick="window.location.href='/toggle/{{ todo.sno }}'" class="action-btn {% if todo.is_complete %}done{% else %}pending{% endif %}">
                                    {% if todo.is_complete %}Undo{% else %}Done{% endif %}
                                </button>
                                {% if not todo.is_complete %}
                                    <button onclick="openUpdateModal('{{ todo.sno }}', '{{ todo.title }}', '{{ todo.desc }}')" class="action-btn update">Update</button>
                                {% endif %}
                                <button onclick="openDeleteModal('{{ todo.sno }}')" class="action-btn delete">Delete</button>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
</div>

<div id="modalOverlay">
    <div id="updateModal">
        <h2>Update To-Do</h2>
        <form method="POST" id="updateForm" action="">
            <input type="hidden" id="modal-sno" name="sno">
            <div class="form-group">
                <label for="modal-title">Title</label>
                <input type="text" name="title" id="modal-title" required>
            </div>
            <div class="form-group">
                <label for="modal-desc">Description</label>
                <input type="text" name="desc" id="modal-desc" required>
            </div>
            <button type="submit">Update</button>
            <button type="button" onclick="closeUpdateModal()">Cancel</button>
        </form>
    </div>

    <div id="deleteModal">
        <h2>Confirm Delete</h2>
        <p>Are you sure you want to delete this to-do?</p>
        <button type="button" id="confirmDeleteBtn">Delete</button>
        <button type="button" onclick="closeDeleteModal()">Cancel</button>
    </div>
</div>
{% endblock body %}